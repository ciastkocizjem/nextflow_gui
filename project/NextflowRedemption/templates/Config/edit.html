{% load static %}
<!DOCTYPE html>
<html>
    <head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
		<script>
			$(document).on('submit', '#post-form',function(e){
				const trs = document.querySelectorAll('#tempTable tr');
					var form_name = $("#name").val();
					var form_config = $("#config").val();
					var form_pipeline = $("#pipeline").val();
					const result = [];

					for(let tr of trs) {
					let th_td = tr.getElementsByTagName('td');
					if (th_td.length == 0) {
						th_td = tr.getElementsByTagName('th');
					}
					
					let th_td_array = Array.from(th_td); // convert HTMLCollection to an Array
					th_td_array = th_td_array.map(tag => tag.innerText); // get the text of each element
					result.push(th_td_array);	
				
				}


				$.ajax({
				method: 'POST',
				url: "1",
				data: { csrfmiddlewaretoken: "{{csrf_token}}", 'table': JSON.stringify(result), 'name': form_name, 'config': form_config, 'pipeline': form_pipeline}
				})
			});


			$(document).ready(function(){
				$(".add-row").click(function(){
					var name = $("#value_name").val();
					var value = $("#value").val();
					var markup = "<tr><td name='value_name'>" + name + "</td><td name='value'>" + value + "</td></tr>";
					$("table tbody").append(markup);

					var url = window.location.pathname;
					var id = url.substring(url.lastIndexOf('/') + 1);

					// $.ajax({
					// method: 'POST',
					// url: "{% url 'TableData' %}",
					// data: { csrfmiddlewaretoken: "{{csrf_token}}", 'name': name, 'value': value, 'id': id }
					// })
				});
				
				// Find and remove selected table rows
				$(".delete-row").click(function(){
					$("table tbody").find('input[name="record"]').each(function(){
						if($(this).is(":checked")){
							$(this).parents("tr").remove();
						}
					});
				});
			}); 
			
			function passTableData() {

				const trs = document.querySelectorAll('#tempTable tr');
					
					const result = [];

					for(let tr of trs) {
					let th_td = tr.getElementsByTagName('td');
					if (th_td.length == 0) {
						th_td = tr.getElementsByTagName('th');
					}
					
					let th_td_array = Array.from(th_td); // convert HTMLCollection to an Array
					th_td_array = th_td_array.map(tag => tag.innerText); // get the text of each element
					result.push(th_td_array);	
				
				}
				$.ajax({
				method: 'POST',
				url: "{% url 'TableData' %}",
				data: { csrfmiddlewaretoken: "{{csrf_token}}", 'table': JSON.stringify(result)}
				})
			}
		</script>
        <link rel="stylesheet" type="text/css" href="{% static 'NextflowRedemption/style.css' %}">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"
    </head>
    <body class="m-3">
        <form method="post" id="post-form"> {% csrf_token %}
        <h1>config page</h1>
        <a href="{% url 'index' %}">main page</a>
        <div class="row justify-content-center">
            <div class="col-2 align-end">Name</div>
            <div class="col-3"><input id="name" name="name"></div>
            <div class="col-2"></div>
            <div class="w-100"></div>
            <div class="col-2 align-end">Pipeline</div>
            <div class="col-3"><input id="pipeline" name="pipeline" value="{{ preset.template_path }}" disabled="disabled"></div>
            <div class="col-2"></div>
            <div class="w-100"></div>
            <div class="col-2 align-end">Configuration</div>
            <div class="col-3"><input id="config" name="config" disabled="disabled" value="{{ preset.template_config }}"></div>
            <div class="col-2"></div>
            <div class="w-100"></div>
            <div class="col-2 align-end">Execution location</div>
            <div class="col-3">
                <div class="row">
                    <div class="col">
                        <input type="radio" id="def_radio" name="exec_loc" value="default" checked>
                        <label for="def_radio">same as pipeline file</label>
                    </div>
                    <div class="col">
                        <input type="radio" id="cus_radio" name="exec_loc" value="custom" >
                        <label for="cus_radio">custom</label>
                    </div>
                </div>
            </div>
            <div class="col-2"></div>
            <div class="w-100"></div>
            <div class="col-2"></div>
            <div class="col-3"><input/></div>
            <div class="col-2"></div>
            <div class="w-100"></div>
            <div class="col-2 align-end">Parameters</div>
            <div class="col-3">
                <table id="tempTable" class="tempTable">
					<thead>
						<tr>
							<th>Name</th>
							<th>Value</th>
						</tr>
					</thead>
                    <tbody>
						
					</tbody>
                </table>
            </div>
            <div class="col-2"></div>
            <div class="w-100"></div>

			<div class="col-3">
				<div class="row">
					<div class="col-3">
						<input type="text" id="value_name" placeholder="Name">
					</div>
					<div class="col-3">
						<input type="text" id="value" placeholder="Value">
					</div>
					<div class="col-3">
						<button type="button" class="add-row" value="Add Row">Add row</button>
					</div>
					<div class="col-3">
						<button type="button" class="delete-row">Remove</button>
					</div>
				</div>
			  </div>
          <!-- <div class="col-2 align-start" style="align-self: flex-end;"><input type="button" class="add-row" value="Add Row"></div> -->
          </div>
          
          <button class="m-5">Remove piepline</button>
		  <button class="m-5" type="submit" value="Add pipeline">Add pipeline</button>
          <!-- <button class="m-5" style="font-weight: bold">Add pipeline</button> -->
		</form>
    </body>
</html>